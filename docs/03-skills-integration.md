# Skills 联动机制

## 各部分如何协作

### 联动流程

```
用户输入 ──► 触发检测 ──► 上下文收集 ──► 逻辑执行 ──► 输出生成
              │              │              │              │
              │              │              │              │
         Rules 约束     Rules 约束     Rules 约束     Rules 约束
              │              │              │              │
              ▼              ▼              ▼              ▼
         行为过滤       信息规范       执行规范       格式规范
```

## Skills 与 Rules 的联动

### 场景示例

假设有以下配置：

**Rules（全局）**：
```markdown
# 代码生成规则
- 所有代码使用 TypeScript
- 必须包含类型定义
- 函数需要 JSDoc 注释
```

**Skill（数据库操作）**：
```markdown
# 数据库 CRUD Skill
生成数据库操作代码
```

**联动效果**：
当 Skill 执行时，会自动遵循 Rules 的约束：
- 生成的代码是 TypeScript 而非 JavaScript
- 所有函数都有类型声明
- 自动添加 JSDoc 注释

## 多 Skills 联动

### 链式调用

```
Skill A 输出 ──► Skill B 输入 ──► Skill C 输入 ──► 最终输出
```

**示例：数据处理流水线**

```markdown
1. [数据探索 Skill]
   输入: 原始数据文件
   输出: 数据质量报告 + 字段分析

2. [数据清洗 Skill]
   输入: 数据质量报告（来自 Skill 1）
   输出: 清洗策略 + 清洗后数据

3. [特征工程 Skill]
   输入: 清洗后数据（来自 Skill 2）
   输出: 特征数据集
```

### 并行执行

```
              ┌──► Skill A ──┐
              │              │
用户输入 ────►├──► Skill B ──┼──► 结果聚合
              │              │
              └──► Skill C ──┘
```

## 上下文传递机制

### 显式传递

```markdown
## Skill A 输出规范
输出 JSON 格式，包含：
- `summary`: 分析摘要
- `details`: 详细数据
- `next_action`: 建议的下一步

## Skill B 输入要求
需要接收：
- `summary` 字段用于快速理解
- `details` 字段用于深入处理
```

### 隐式传递

通过会话上下文自动传递：
- 之前的分析结果
- 用户的偏好设置
- 项目的元信息

## Rules 的约束层级

```
┌─────────────────────────────────────────┐
│         全局 Rules (最高优先级)          │
│    ~/.claude/rules/global.md           │
├─────────────────────────────────────────┤
│         项目 Rules                       │
│    .claude/rules/project.md            │
├─────────────────────────────────────────┤
│         Skill 内置约束                   │
│    Skill 定义中的 Constraints           │
└─────────────────────────────────────────┘
```

**冲突解决**：上层 Rules 优先级高于下层

## 实战示例：企信宝数据探索

### 场景设置

**目标**：自动探索企信宝数据并整合分析

**涉及组件**：
- Rule: 数据安全规范
- Skill: 数据探索
- Skill: 数据整合

### 联动流程

```markdown
1. 用户请求："分析企信宝数据"

2. [触发检测]
   - 匹配关键词 "企信宝" + "数据"
   - 激活 "数据探索 Skill"

3. [Rules 约束检查]
   - 数据安全规范生效
   - 确保不泄露敏感信息

4. [上下文收集]
   - 定位数据源
   - 识别数据格式
   - 获取字段说明

5. [执行探索 Skill]
   - 基础统计分析
   - 数据质量评估
   - 生成探索报告

6. [触发整合 Skill]
   - 接收探索报告
   - 执行数据整合
   - 生成最终输出

7. [输出生成]
   - 遵循输出格式规范
   - 应用数据脱敏 Rules
   - 返回结构化报告
```

## 调试联动问题

### 常见问题

1. **Skill 未触发** - 检查触发条件是否正确
2. **Rules 未生效** - 检查文件路径和优先级
3. **上下文丢失** - 检查输出/输入格式匹配
4. **冲突行为** - 检查 Rules 优先级设置

### 调试方法

```markdown
# 在 Skill 中添加调试输出
## 调试模式
当 DEBUG=true 时：
- 输出触发条件匹配结果
- 显示收集到的上下文
- 列出生效的 Rules
- 显示执行步骤追踪
```

## 下一步

阅读 [04-skills-model.md](04-skills-model.md) 了解 Skills 的抽象模型。
